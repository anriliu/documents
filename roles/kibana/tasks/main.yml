---
- name: copy kibana 6.x serve rpm repository
  copy: src={{item}} dest="/etc/yum.repos.d/kibana.repo"  
  with_items:
    - openresty.repo
    - kibana.repo
- name: install kibana and openresty server
  yum: name={{item}} state=present
  with_items:
    - kibana-{{kibana.version}}
    - openresty
  notify: restart kibana
- name: check x-pack plugin folder
  stat: path=/usr/share/kibana/plugins/x-pack/
  register: xpack
- name: install X-Pack plugin
  shell: /usr/share/kibana/bin/kibana-plugin install x-pack
  when: "xpack.stat.exists == False"
  notify: restart kibana
- name: update kibana configuration
  template: src=kibana.yml.j2 dest=/etc/kibana/kibana.yml
  notify: restart kibana 
