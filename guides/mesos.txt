download binary package from
https://open.mesosphere.com/downloads/mesos/
or
rpm -Uvh http://repos.mesosphere.com/el/6/noarch/RPMS/mesosphere-el-repo-6-3.noarch.rpm
rpm -Uvh http://repos.mesosphere.com/el/7/noarch/RPMS/mesosphere-el-repo-7-3.noarch.rpm
yum -y install --enablerepo=mesosphere mesos

master需要开启5050端口，slave开启5051端口
mesos-master --hostname=172.18.91.139 --ip=172.18.91.139 --hostname_lookup=false --work_dir=/var/lib/mesos/ --log_dir=/var/log/mesos/
mesos-agent --master=172.18.91.139:5050 --containerizers=docker,mesos --work_dir=/var/lib/mesos-slave --switch_user=false --hostname_lookup=false --log_dir=/var/log/mesos/ --resources='cpus(*):2;mem(*):1000;ports(*):[1000-65535];disk(*):65526'
默认disk是所有的空余disk,ports是31000-32000,ports resources在创建docker做 port mapping的时候需要用到

mesos can also use environment variable MESOS_OPTION_NAME as it's option

http://172.18.91.139:5050/slaves 查看所有slave的信息
curl -XPOST http://172.18.91.139:5050/teardown -d 'frameworkId=0164eece-8f5c-4f9b-963e-b452facf036c-0205' #删除一个正在运行的firmwork并删除所有与之相关的tasks

to install marathon
yum -y install --enablerepo=mesosphere  marathon
default marathon need zookeeper to store data and ha election if you only have one host then you can run marathon with below options:
--internal_store_backend mem --disable_ha

marathon can also use environment variable MARATHON_OPTION_NAME as it's option
mesos（marathon）启动一个docker overlay network的container,只需要将docker的network选择为“BRIDGE”然后将自定义docker参数的值设置为“{“key”: “net”, “value”: “your-overlay-network”}”即可,这是因为docker run的命令航只会接收最后一个--network 参数

http://172.18.91.139:8080/v2/queue  查看all the tasks queued up or waiting to be scheduled
curl -H "Accept: text/event-stream"  <MARATHON_HOST>:<MARATHON_PORT>/v2/events #检查



port-mapping:
A port-mapping declares a container-port for an application, possibly linking that container-port to a host-port and service-port. Marathon communicates container-port/host-port links (aka “mappings”) to Mesos when launching instances of the application. Port-mappings are used with both container and container/bridge networking. Marathon ignores the value of requirePorts when interpreting a port-mapping.
The special containerPort value of 0 tells Marathon to internally assign the (eventually) allocated host-port to containerPort.
The special hostPort value of 0 tells Marathon to select any host-port from a Mesos resource offer.
The special servicePort value of 0 tells Marathon to select any service-port from the configured service-port range.
在marathon-lb和mesos slave运行在相同的机器时，最好是设置hostPort=0这样就可以避免端口冲突




Marathon-lb is a tool for managing HAProxy, by consuming Marathon's app state 
docker run -e PORTS=9090 mesosphere/marathon-lb sse  --marathon http://localhost:8080 --auth-credentials=admin:password --ssl-certs /etc/ssl/site1.co,/etc/ssl/site2.co --health-check --strict-mode
