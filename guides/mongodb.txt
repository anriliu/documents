enable auth:
1.create super admin
use admin
db.createUser(
  {
    user: "myUserAdmin",
    pwd: "abc123",
    roles: [ { role: "root", db: "admin" } ]
  }
)

vi  /etc/mongod.conf 

security:
   authorization: enabled

For replication you have to setup one of below internal authentication if enabled authorization
a. Keyfiles
echo -e "my secret key" > mongo.keyfile
chmod 600 mongo.keyfile
chown mongod mongo.keyfile
To specify the keyfile, use the security.keyFile setting or --keyFile command line option.


b. x.509
security.clusterAuthMode and net.ssl.clusterFile if using a configuration file, or
--clusterAuthMode and --sslClusterFile command line options.

2. create db owner for specified db
mongo --port 27017 -u "myUserAdmin" -p "abc123" --authenticationDatabase "admin"
or 
use admin
db.auth("myUserAdmin", "abc123" )
then

use mydb
db.createUser(
  {
    user: "myTester",
    pwd: "xyz123",
    roles: [ { role: "dbOwner", db: "mydb" } ]
  }
)

db.createUser(
  {
    user: "myTester",
    pwd: "xyz123",
    roles: [ { role: "readWrite", db: "test" },
             { role: "read", db: "reporting" } ]
  }
)


replication:
following example specifies the replica set name through the --replSet command-line option
You can also specify the security.replSetName in a configuration file. 

Use rs.initiate() on one and only one member of the replica set:
then change first member host name to ip before add other memebers because it always set the first member host name as os hostname and other memebers may not able to connect 
cfg = rs.conf()
cfg.members[0].host = "192.168.168.21:27017"
rs.reconfig(cfg) 

rs.reconfig(cfg, {force : true}) #When you use force : true, the version number in the replica set configuration increases significantly, by tens or hundreds of thousands.
# rs.reconfig() shell method can force the current primary to step down, which causes an election. When the primary steps down, the mongod closes all client connections. 

then add the rest members from primary:
rs.add("192.168.168.23")
use rs.addArb() to Arbiter which hold  no data but can elect a primary,if you want to convert a secondary node to arbiter you must stop and remove its data file first

You can force a replica set member to become primary by giving it a higher members[n].priority
members[n].priority value to 0, which means the member can never seek election as primary. 

to delete memeber from replication set:
a.when u have more than two memebers online
rs.remove()
b.when u have less than three online memebers you can't do rs.remove because if one server from two is down, the mongodb setting is configured to not allow any writes to the remaining online server. 
cfg = rs.conf()
cfg.members.splice(2,1)  ##从rs.conf()的memebers列表中id为2的元素，开始的第1个member，也就是id为2的member 
rs.reconfig(cfg) 

修改同步的目标
rs.syncFrom("hostname<:port>");
connect to primary
mongo "mongodb://172.18.91.147:27017,172.18.91.148:27017,172.18.91.149:27017/dbname?replicaSet=repname" -uusernmae -ppasswd

Convert replicati to standalone
1. dorp local db
use local
db.dropDatabase();
2.change configurations
comment out configuration file about if you have replication configuration
systemctl restart mongod 

mongodumi以bson格式备份数据库或者collections,备份后的文件可以通过mongorestore来恢复：
mongodump  --db test
mongodump  --db test --collection collection
mongodump --host mongodb1.example.net --port 37017 --username user --password pass --out /opt/backup/mongodump-2011-10-24

mongorestore --collection people --db accounts dump/accounts/people.bson
mongorestore --host mongodb1.example.net --port 37017 --username user --password pass /opt/backup/mongodump-2011-10-24

mongoexport可以以json或者csv格式导出数据库中的某个collection，然后通过mongoimport导入:
mongoexport --db users --collection contacts --csv --fieldFile fields.txt --out /opt/backups/contacts.csv
mongoexport --db sales --collection contacts --out contacts.json --journal


可以通过下面的方式来导出所有的collections:
for c in `mongo --quiet $host:$port/$db --eval 'db.getCollectionNames()' | sed 's/,/ /g'`
do
    mongoexport --host $host --port $port -d $db -c $c > $c.json
done
mongoexport -d test -c records -q "{ a: { \$gte: 3 } }" --out exportdir/myRecords.json
mongoimport --db users --collection contacts --type csv --headerline --file /opt/backups/contacts.csv
如果没有指定-c 那么会以文件名为collectoin name
mongoimport --db users --type csv --headerline --file /opt/backups/contacts.csv
